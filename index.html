<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#fef7f9" />
  <title>ÿ®ÿ±ÿß€å ÿµÿ®ÿß ⁄©Ÿàÿ¥ŸàŸÑŸà</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="favicon.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lalezar&family=Marcellus&family=Italiana&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #fef7f9;
      --surface: #fffbfc;
      --border: #f0dce2;
      --text: #2d1f24;
      --muted: #8a6b73;
      --accent: #c93d5c;
      --accent-soft: rgba(201, 61, 92, 0.18);
      --gold: #b8860b;
      --gold-soft: rgba(184, 134, 11, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    ::selection {
      background: var(--accent-soft);
      color: var(--text);
    }

    :focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    body {
      font-family: 'Marcellus', 'Georgia', serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem 3rem;
      position: relative;
      background-image:
        radial-gradient(ellipse 90% 60% at 50% -5%, rgba(255, 230, 240, 0.8), transparent),
        radial-gradient(ellipse 70% 50% at 100% 100%, rgba(255, 210, 230, 0.4), transparent),
        radial-gradient(ellipse 50% 40% at 0% 80%, rgba(255, 220, 235, 0.3), transparent);
    }

    .stars-wrap {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 8px 2px rgba(255, 255, 255, 0.9), 0 0 4px 1px rgba(255, 200, 220, 0.6);
      animation: star-twinkle 3s ease-in-out infinite;
      display: block;
    }

    @keyframes star-twinkle {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.15); }
    }

    .star:nth-child(1)  { left: 7%;  top: 12%; animation-delay: 0s; }
    .star:nth-child(2)  { left: 22%; top: 6%;  animation-delay: 0.4s; }
    .star:nth-child(3)  { left: 38%; top: 18%; animation-delay: 1.2s; }
    .star:nth-child(4)  { left: 55%; top: 8%;  animation-delay: 0.8s; }
    .star:nth-child(5)  { left: 72%; top: 14%; animation-delay: 1.6s; }
    .star:nth-child(6)  { left: 88%; top: 10%; animation-delay: 0.2s; }
    .star:nth-child(7)  { left: 12%; top: 28%; animation-delay: 1s; }
    .star:nth-child(8)  { left: 45%; top: 32%; animation-delay: 1.4s; }
    .star:nth-child(9)  { left: 78%; top: 26%; animation-delay: 0.6s; }
    .star:nth-child(10) { left: 5%;  top: 48%; animation-delay: 1.8s; }
    .star:nth-child(11) { left: 32%; top: 52%; animation-delay: 0.3s; }
    .star:nth-child(12) { left: 62%; top: 44%; animation-delay: 1.1s; }
    .star:nth-child(13) { left: 90%; top: 50%; animation-delay: 1.5s; }
    .star:nth-child(14) { left: 18%; top: 68%; animation-delay: 0.7s; }
    .star:nth-child(15) { left: 52%; top: 72%; animation-delay: 0.5s; }
    .star:nth-child(16) { left: 82%; top: 66%; animation-delay: 1.3s; }
    .star:nth-child(17) { left: 8%;  top: 85%; animation-delay: 0.9s; }
    .star:nth-child(18) { left: 42%; top: 88%; animation-delay: 0.1s; }
    .star:nth-child(19) { left: 68%; top: 82%; animation-delay: 1.7s; }
    .star:nth-child(20) { left: 95%; top: 90%; animation-delay: 0.5s; }

    .star:nth-child(3),
    .star:nth-child(8),
    .star:nth-child(12),
    .star:nth-child(15) { width: 6px; height: 6px; box-shadow: 0 0 10px 3px rgba(255, 255, 255, 0.95), 0 0 6px 2px rgba(255, 210, 230, 0.6); }
    .star:nth-child(2),
    .star:nth-child(5),
    .star:nth-child(10),
    .star:nth-child(17) { width: 3px; height: 3px; }

    @media (prefers-reduced-motion: reduce) {
      .star { animation: none; opacity: 0.85; }
    }

    .meteors-wrap {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .meteors-wrap canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    header {
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }

    h1 {
      font-family: 'Lalezar', cursive;
      font-weight: 400;
      font-size: clamp(1.6rem, 5vw, 2.2rem);
      color: var(--text);
      letter-spacing: 0.02em;
      text-shadow: 0 2px 4px rgba(201, 61, 92, 0.12);
    }

    .header-hint {
      font-family: 'Lalezar', cursive;
      font-size: 1rem;
      color: var(--muted);
      margin-top: 0.35rem;
      padding: 0.4rem 0.85rem;
      display: inline-block;
      background: var(--accent-soft);
      border-radius: 999px;
      border: 1px solid var(--border);
      letter-spacing: 0.02em;
      box-shadow: 0 2px 8px rgba(201, 61, 92, 0.08);
    }

    .card {
      position: relative;
      z-index: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 1.75rem;
      width: 100%;
      max-width: 420px;
      box-shadow:
        0 4px 24px rgba(201, 61, 92, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.6) inset;
    }

    .canvas-wrap {
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      background: linear-gradient(180deg, #fffafb 0%, #fef5f7 100%);
      margin-bottom: 1.5rem;
      aspect-ratio: 1;
      max-width: 372px;
      margin-left: auto;
      margin-right: auto;
    }

    #graph {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: contain;
      vertical-align: middle;
    }

    .controls {
      padding: 0.25rem 0;
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: linear-gradient(to right, var(--accent-soft) 0%, rgba(201, 61, 92, 0.35) 50%, var(--accent-soft) 100%);
      border-radius: 999px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(145deg, #fff 0%, #f8e8ec 100%);
      border: 2px solid var(--accent);
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(201, 61, 92, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.08);
      box-shadow: 0 4px 16px rgba(201, 61, 92, 0.35);
    }

    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(145deg, #fff 0%, #f8e8ec 100%);
      border: 2px solid var(--accent);
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(201, 61, 92, 0.3);
    }

    @media (prefers-reduced-motion: reduce) {
      .confetti-particle,
      .modal,
      .modal-step-enter .modal-heart,
      .modal-step-enter .modal-message,
      .modal-step-enter .modal-btn {
        animation: none !important;
      }
      .modal-heart { opacity: 1; }
    }

    .confetti-wrap {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 101;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .confetti-wrap.is-active {
      opacity: 1;
    }

    .confetti-particle {
      position: absolute;
      font-size: 1.35rem;
      left: 50%;
      top: 50%;
      margin-left: -0.5em;
      margin-top: -0.5em;
      animation: confetti-burst 2.6s ease-out forwards;
      opacity: 0;
    }

    @keyframes confetti-burst {
      0% {
        opacity: 0;
        transform: translate(0, 0) scale(0.2);
      }
      12% {
        opacity: 1;
        transform: translate(var(--dx), var(--dy)) scale(1.05);
      }
      90% {
        opacity: 0.85;
        transform: translate(
          calc(var(--dx) + var(--drift)),
          calc(var(--dy) + 100px)
        ) scale(0.95);
      }
      100% {
        opacity: 0;
        transform: translate(
          calc(var(--dx) + var(--drift)),
          calc(var(--dy) + 160px)
        ) scale(0.7);
      }
    }

    .strawberry-rain-wrap {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 99;
      overflow: hidden;
      visibility: hidden;
    }

    .strawberry-rain-wrap.is-active {
      visibility: visible;
    }

    .strawberry-rain-wrap .strawberry {
      position: absolute;
      top: -1.5em;
      left: var(--x, 0);
      font-size: clamp(1.25rem, 4vw, 1.75rem);
      line-height: 1;
      opacity: 0.9;
      animation: strawberry-fall linear forwards;
    }

    @keyframes strawberry-fall {
      to {
        transform: translateY(calc(100vh + 2em));
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .strawberry-rain-wrap .strawberry { animation: none; opacity: 0; }
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255, 245, 250, 0.85);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }

    .modal-overlay.is-open {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: linear-gradient(165deg, #fffbfc 0%, #fef5f8 40%, #fceef3 100%);
      border: 2px solid var(--border);
      border-radius: 24px;
      padding: 2.5rem 2.25rem 2rem;
      max-width: 340px;
      text-align: center;
      position: relative;
      box-shadow: 0 28px 56px rgba(45, 31, 36, 0.22), 0 0 0 1px rgba(255,255,255,0.9) inset;
      transform: scale(0.88) translateY(10px);
      opacity: 0;
      transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.45s ease;
      overflow: visible;
    }

    .modal-overlay.is-open .modal {
      transform: scale(1) translateY(0);
      opacity: 1;
    }

    .modal.modal-step-enter .modal-heart {
      animation: modal-emoji-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    .modal.modal-step-enter .modal-message {
      animation: modal-message-in 0.45s cubic-bezier(0.34, 1.2, 0.64, 1) 0.08s both;
    }

    .modal.modal-step-enter .modal-btn {
      animation: modal-btn-in 0.4s cubic-bezier(0.34, 1.2, 0.64, 1) 0.2s both;
    }

    .modal.modal-step-enter .modal-btn:nth-child(2) {
      animation-delay: 0.28s;
    }

    @keyframes modal-emoji-in {
      from {
        opacity: 0;
        transform: scale(0.3);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes modal-message-in {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes modal-btn-in {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-heart {
      font-size: 3rem;
      line-height: 1;
      margin-bottom: 1rem;
      text-align: center;
      opacity: 1;
    }

    .modal-message {
      font-family: 'Lalezar', cursive;
      font-size: 1.55rem;
      color: var(--text);
      line-height: 1.6;
      margin: 0;
      text-align: center;
    }

    .modal-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .modal-btn {
      font-family: 'Lalezar', cursive;
      font-size: 1.2rem;
      padding: 0.6rem 1.25rem;
      border-radius: 999px;
      border: 2px solid var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
      cursor: pointer;
      transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
    }

    .modal-btn:hover {
      background: rgba(201, 61, 92, 0.28);
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(201, 61, 92, 0.25);
    }

    @media (max-width: 480px) {
      body {
        padding: 1rem 0.75rem 2rem;
        padding-left: max(0.75rem, env(safe-area-inset-left));
        padding-right: max(0.75rem, env(safe-area-inset-right));
        padding-bottom: max(2rem, env(safe-area-inset-bottom));
      }

      header {
        margin-bottom: 1rem;
      }

      h1 {
        font-size: clamp(1.35rem, 6vw, 1.85rem);
      }

      .header-hint {
        font-size: 0.9rem;
        padding: 0.35rem 0.7rem;
        margin-top: 0.25rem;
      }

      .card {
        padding: 1.25rem;
        border-radius: 16px;
        max-width: 100%;
      }

      .canvas-wrap {
        margin-bottom: 1rem;
        border-radius: 12px;
      }

      .controls {
        padding: 0.15rem 0;
      }

      input[type="range"] {
        height: 8px;
      }

      input[type="range"]::-webkit-slider-thumb {
        width: 26px;
        height: 26px;
      }

      input[type="range"]::-moz-range-thumb {
        width: 26px;
        height: 26px;
      }

      .modal-overlay {
        padding: 1rem;
        align-items: center;
        justify-content: center;
      }

      .modal {
        max-width: calc(100% - 2rem);
        width: 100%;
        padding: 1.75rem 1.5rem 1.5rem;
        border-radius: 20px;
      }

      .modal-heart {
        font-size: 2.5rem;
        margin-bottom: 0.75rem;
      }

      .modal-message {
        font-size: 1.35rem;
        line-height: 1.5;
      }

      .modal-buttons {
        margin-top: 1.25rem;
        gap: 0.6rem;
      }

      .modal-btn {
        font-size: 1.1rem;
        padding: 0.65rem 1.15rem;
        min-height: 44px;
      }
    }

    @media (max-width: 360px) {
      h1 { font-size: 1.25rem; }
      .header-hint { font-size: 0.85rem; }
      .modal-message { font-size: 1.2rem; }
      .modal-btn { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="stars-wrap" aria-hidden="true">
    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
    <span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span><span class="star"></span>
  </div>
  <div class="meteors-wrap" aria-hidden="true">
    <canvas id="meteorsCanvas"></canvas>
  </div>

  <header>
    <h1>‚≠ê ÿ®ÿ±ÿß€å ÿµÿ®ÿß ⁄©Ÿàÿ¥ŸàŸÑŸà</h1>
    <p class="header-hint">ÿßÿ≥ŸÑÿß€åÿØÿ± ÿ±Ÿà ÿ™ÿß ÿ™Ÿá ÿ®⁄©ÿ¥ Ÿà ÿµÿ®ÿ± ⁄©ŸÜ</p>
  </header>

  <main class="card">
    <div class="canvas-wrap">
      <canvas id="graph"></canvas>
    </div>

    <div class="controls">
      <input type="range" id="slider" min="-10" max="10" step="0.1" value="0" aria-label="Slider" />
    </div>
  </main>

  <div class="confetti-wrap" id="confetti" aria-hidden="true"></div>
  <div class="strawberry-rain-wrap" id="strawberryRain" aria-hidden="true"></div>

  <div class="modal-overlay" id="modal" aria-hidden="true">
    <div class="modal" id="modalBox">
      <div class="modal-heart" id="modalEmoji" aria-hidden="true"></div>
      <p class="modal-message" id="modalMessage"></p>
      <div class="modal-buttons" id="modalButtons"></div>
    </div>
  </div>

  <script>
    (function () {
      const meteorsCanvas = document.getElementById('meteorsCanvas');
      const meteorsWrap = meteorsCanvas.closest('.meteors-wrap');

      function initMeteors() {
        const ctx = meteorsCanvas.getContext('2d');
        if (!ctx) return;

        const METEOR_COUNT = 8;
        const meteors = [];
        let width = 0;
        let height = 0;

        function createMeteor(fromLeft, w, h) {
          const speedPxPerSec = 140 + Math.random() * 80;
          const angle = fromLeft
            ? -0.42 - Math.random() * 0.25
            : Math.PI - 0.42 - Math.random() * 0.25;
          const vx = Math.cos(angle) * speedPxPerSec;
          const vy = Math.sin(angle) * speedPxPerSec;
          return {
            x: fromLeft ? -30 : (w || 400) + 30,
            y: Math.random() * (h || 400) * 0.85,
            vx: vx,
            vy: vy,
            angle: angle,
            angleSpeed: (Math.random() - 0.5) * 0.012,
            tailLength: 45 + Math.random() * 35,
            life: 0,
            delay: Math.random() * 2000,
            fromLeft: fromLeft,
            tailDir: fromLeft ? 1 : -1
          };
        }

        let lastTime = 0;
        function loop(time) {
          const dt = Math.min((time - lastTime) / 16.67, 4);
          lastTime = time;

          const w = width;
          const h = height;
          if (w <= 0 || h <= 0) {
            requestAnimationFrame(loop);
            return;
          }
          ctx.clearRect(0, 0, w, h);

          meteors.forEach(function (m) {
            if (m.delay > 0) {
              m.delay -= dt * 16;
              return;
            }

            const sec = dt / 60;
            m.x += m.vx * sec;
            m.y += m.vy * sec;
            m.angle += m.angleSpeed * dt;
            m.life += (1 / 420) * dt * 60;

            const easeIn = 1 - Math.pow(1 - m.life, 1.4);
            const alpha = Math.max(0, Math.min(1, easeIn * 2) * (1 - easeIn) * 4);
            if (alpha < 0.02 || (m.fromLeft && m.x > w + 50) || (!m.fromLeft && m.x < -50)) {
              m.life = 0;
              m.x = m.fromLeft ? -30 : w + 30;
              m.y = Math.random() * h * 0.85;
              m.delay = 800 + Math.random() * 2200;
              m.angle = -0.42 - Math.random() * 0.25;
              m.angleSpeed = (Math.random() - 0.5) * 0.012;
              m.tailLength = 45 + Math.random() * 35;
              return;
            }

            ctx.save();
            ctx.translate(m.x, m.y);
            ctx.rotate(m.angle);

            const tailLen = m.tailLength * (0.88 + 0.12 * Math.sin(time * 0.0015)) * m.tailDir;
            const gradient = ctx.createLinearGradient(tailLen, 0, 0, 0);
            gradient.addColorStop(0, 'rgba(255, 200, 220, 0)');
            gradient.addColorStop(0.4, 'rgba(255, 180, 210, ' + (0.35 * alpha) + ')');
            gradient.addColorStop(0.85, 'rgba(255, 220, 235, ' + (0.7 * alpha) + ')');
            gradient.addColorStop(1, 'rgba(255, 255, 255, ' + alpha + ')');

            ctx.strokeStyle = gradient;
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(tailLen, 0);
            ctx.lineTo(0, 0);
            ctx.stroke();

            ctx.fillStyle = 'rgba(255, 255, 255, ' + alpha + ')';
            ctx.beginPath();
            ctx.arc(0, 0, 2.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
          });

          requestAnimationFrame(loop);
        }

        function resize() {
          const dpr = Math.min(2, window.devicePixelRatio || 1);
          const rect = meteorsWrap.getBoundingClientRect();
          width = rect.width;
          height = rect.height;
          meteorsCanvas.width = rect.width * dpr;
          meteorsCanvas.height = rect.height * dpr;
          meteorsCanvas.style.width = rect.width + 'px';
          meteorsCanvas.style.height = rect.height + 'px';
          ctx.setTransform(1, 0, 0, 1, 0, 0);
          ctx.scale(dpr, dpr);
          if (meteors.length === 0) {
            for (let i = 0; i < METEOR_COUNT; i++) {
              meteors.push(createMeteor(i % 2 === 0, width, height));
              meteors[i].delay = (i / METEOR_COUNT) * 1800;
            }
          }
        }

        resize();
        window.addEventListener('resize', resize);
        requestAnimationFrame(loop);
      }

      if (meteorsCanvas && meteorsWrap) initMeteors();
    })();

    (function () {
      const canvas = document.getElementById('graph');
      const ctx = canvas.getContext('2d');
      const slider = document.getElementById('slider');
      const modal = document.getElementById('modal');
      const modalBox = document.getElementById('modalBox');
      const modalEmoji = document.getElementById('modalEmoji');
      const modalMessage = document.getElementById('modalMessage');
      const modalButtons = document.getElementById('modalButtons');
      const confettiWrap = document.getElementById('confetti');
      const strawberryRainWrap = document.getElementById('strawberryRain');

      const CONFETTI_EMOJIS = ['‚ù§Ô∏è', 'üíï', '‚≠ê', '‚ú®', 'üçì', 'ü¶ã', 'üíñ', 'üåü'];
      const PARTICLE_COUNT = 42;

      const MODAL_STEPS = [
        null,
        {
          message: 'ÿ®ÿ®ÿÆÿ¥€åÿØ ÿÆÿßŸÜŸàŸÖ ŸÖ€åÿ™ŸàŸÜŸÖ €åŸá ŸÑÿ≠ÿ∏Ÿá ŸàŸÇÿ™ÿ™ŸàŸÜŸà ÿ®⁄Ø€åÿ±ŸÖÿü',
          emoji: 'üòé',
          buttons: ['ÿ¢ÿ±Ÿá', 'ÿ¢ÿØ€å€å€å€å€å€å€å']
        },
        {
          message: 'ŸÖ€åŸàŸàŸàŸàŸàŸàŸàŸàŸàŸàŸà',
          emoji: 'üê±',
          buttons: ['üêà ŸÖ€åŸàŸàŸàŸàŸàŸàŸàŸàŸàŸàŸà']
        },
        {
          message: 'ÿ®ÿ±€åŸÖ ŸÖÿØÿßŸÑ ÿ®ÿπÿØ€å ⁄©Ÿàÿ¥ŸàŸÑŸàÿü',
          emoji: 'üíÉüï∫',
          buttons: ['ÿ®ÿßÿ¥Ÿá', 'ÿ®ÿßÿ¨€å']
        },
        {
          message: 'ÿ±Ÿàÿ≤ÿ™ ŸÖÿ®ÿßÿ±⁄© ⁄ØŸàŸÖÿ®ŸàŸÑ€å ŸÖŸÜ',
          emoji: '‚ù§Ô∏è',
          buttons: ['ŸÖÿ±ÿ≥€å', 'üôä ŸÖÿ¥€å ŸÖÿ¥€å ']
        }
      ];

      let secretTimer = null;
      let modalStep = 0;
      let heartAutoAnim = false;
      let heartAnimStart = 0;
      let autoAnimA = 0;

      function runConfetti() {
        confettiWrap.innerHTML = '';
        confettiWrap.classList.add('is-active');
        for (let i = 0; i < PARTICLE_COUNT; i++) {
          const p = document.createElement('span');
          p.className = 'confetti-particle';
          p.textContent = CONFETTI_EMOJIS[Math.floor(Math.random() * CONFETTI_EMOJIS.length)];
          const angle = (Math.PI * 2 * i) / PARTICLE_COUNT + Math.random() * 0.8;
          const dist = 40 + Math.random() * 80;
          const dx = Math.cos(angle) * dist;
          const dy = Math.sin(angle) * dist - 20;
          const drift = (Math.random() - 0.5) * 60;
          p.style.setProperty('--dx', dx + 'px');
          p.style.setProperty('--dy', dy + 'px');
          p.style.setProperty('--drift', drift + 'px');
          p.style.animationDelay = (Math.random() * 0.25) + 's';
          confettiWrap.appendChild(p);
        }
        setTimeout(function () {
          confettiWrap.classList.remove('is-active');
        }, 3000);
      }

      function runStrawberryRain() {
        if (!strawberryRainWrap) return;
        strawberryRainWrap.innerHTML = '';
        strawberryRainWrap.classList.add('is-active');
        const count = 40;
        const durationMin = 4;
        const durationMax = 8;
        for (let i = 0; i < count; i++) {
          const s = document.createElement('span');
          s.className = 'strawberry';
          s.textContent = 'üçì';
          s.style.setProperty('--x', (Math.random() * 100) + '%');
          s.style.animationDelay = (Math.random() * 3) + 's';
          s.style.animationDuration = (durationMin + Math.random() * (durationMax - durationMin)) + 's';
          strawberryRainWrap.appendChild(s);
        }
        setTimeout(function () {
          strawberryRainWrap.classList.remove('is-active');
          strawberryRainWrap.innerHTML = '';
        }, 12000);
      }

      function triggerStepEnterAnimation() {
        modalBox.classList.remove('modal-step-enter');
        modalBox.offsetHeight;
        modalBox.classList.add('modal-step-enter');
        setTimeout(function () {
          modalBox.classList.remove('modal-step-enter');
        }, 600);
      }

      function renderModalStep(step) {
        const data = MODAL_STEPS[step];
        if (!data) return;
        modalMessage.textContent = data.message;
        modalEmoji.textContent = data.emoji || '';
        modalEmoji.style.display = data.emoji ? '' : 'none';
        modalButtons.innerHTML = '';
        data.buttons.forEach(function (label) {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'modal-btn';
          btn.textContent = label;
          btn.addEventListener('click', function () {
            if (step === 4) {
              modal.classList.remove('is-open');
              modal.setAttribute('aria-hidden', 'true');
              modalStep = 0;
              runConfetti();
              runStrawberryRain();
              startHeartAutoAnimation();
            } else {
              modalStep = step + 1;
              renderModalStep(modalStep);
              if (modalStep === 4) runConfetti();
            }
          });
          modalButtons.appendChild(btn);
        });
        triggerStepEnterAnimation();
      }

      function openFirstModal() {
        modalStep = 1;
        renderModalStep(modalStep);
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
      }

      function checkSecret() {
        const val = parseFloat(slider.value);
        const atEnd = val >= 9.9 || val <= -9.9;
        if (atEnd) {
          if (!secretTimer) {
            secretTimer = setTimeout(function () {
              openFirstModal();
              secretTimer = null;
            }, 1000);
          }
        } else {
          if (secretTimer) {
            clearTimeout(secretTimer);
            secretTimer = null;
          }
        }
      }

      function startHeartAutoAnimation() {
        heartAutoAnim = true;
        heartAnimStart = Date.now();
      }

      function updateHeartAutoAnimation() {
        if (!heartAutoAnim) return;
        const t = (Date.now() - heartAnimStart) * 0.0008;
        autoAnimA = 10 + 10 * (1 + Math.sin(t)) / 2;
        draw();
      }

      const padding = 28;
      const sqrt33 = Math.sqrt(3.3);
      const xMin = -sqrt33;
      const xMax = sqrt33;
      const xRange = xMax - xMin;
      const sampleCount = 1200;

      function f(x, a) {
        const x2 = x * x;
        if (x2 > 3.3) return NaN;
        const term1 = Math.pow(x * x, 1 / 3);
        const term2 = Math.sqrt(3.3 - x2) * Math.sin(a * Math.PI * x);
        return term1 + term2;
      }

      function draw() {
        const a = heartAutoAnim ? autoAnimA : parseFloat(slider.value);

        const dpr = Math.min(2, window.devicePixelRatio || 1);
        const rect = canvas.getBoundingClientRect();
        const size = Math.min(rect.width, rect.height);
        const w = Math.round(size * dpr);
        const h = w;
        if (canvas.width !== w || canvas.height !== h) {
          canvas.width = w;
          canvas.height = h;
        }

        const W = canvas.width;
        const H = canvas.height;
        const plotLeft = padding * dpr;
        const plotTop = padding * dpr;
        const plotRight = W - padding * dpr;
        const plotBottom = H - padding * dpr;
        const plotSize = plotRight - plotLeft;

        const yValues = [];
        for (let i = 0; i <= sampleCount; i++) {
          const x = xMin + (i / sampleCount) * xRange;
          yValues.push(f(x, a));
        }
        const validY = yValues.filter(v => isFinite(v));
        const yMin = Math.min(...validY);
        const yMax = Math.max(...validY);
        const yMargin = (yMax - yMin) * 0.1 || 0.5;
        const yLo = yMin - yMargin;
        const yHi = yMax + yMargin;
        const yRange = yHi - yLo;

        const scale = Math.min(plotSize / xRange, plotSize / yRange);
        const plotW = xRange * scale;
        const plotH = yRange * scale;
        const ox = plotLeft + (plotSize - plotW) / 2 + plotW / 2;
        const oy = plotBottom - (plotSize - plotH) / 2 - plotH / 2;

        function toX(x) {
          return ox + (x - (xMin + xMax) / 2) * scale;
        }
        function toY(y) {
          return oy - (y - (yLo + yHi) / 2) * scale;
        }

        ctx.clearRect(0, 0, W, H);

        ctx.strokeStyle = 'rgba(214, 77, 110, 0.12)';
        ctx.lineWidth = 1;
        const gridSteps = 5;
        for (let i = 1; i < gridSteps; i++) {
          const x = xMin + (i / gridSteps) * xRange;
          ctx.beginPath();
          ctx.moveTo(toX(x), plotTop);
          ctx.lineTo(toX(x), plotBottom);
          ctx.stroke();
        }
        for (let i = 1; i < gridSteps; i++) {
          const y = yLo + (i / gridSteps) * yRange;
          ctx.beginPath();
          ctx.moveTo(plotLeft, toY(y));
          ctx.lineTo(plotRight, toY(y));
          ctx.stroke();
        }

        ctx.strokeStyle = 'rgba(214, 77, 110, 0.28)';
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        ctx.moveTo(toX(0), plotTop);
        ctx.lineTo(toX(0), plotBottom);
        ctx.moveTo(plotLeft, toY(0));
        ctx.lineTo(plotRight, toY(0));
        ctx.stroke();

        const gradient = ctx.createLinearGradient(0, plotTop, 0, plotBottom);
        gradient.addColorStop(0, '#e88a9e');
        gradient.addColorStop(0.5, '#d64d6e');
        gradient.addColorStop(1, '#c93d5c');
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 2.5;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.beginPath();

        let started = false;
        for (let i = 0; i <= sampleCount; i++) {
          const x = xMin + (i / sampleCount) * xRange;
          const y = f(x, a);
          if (!isFinite(y)) {
            started = false;
            continue;
          }
          const px = toX(x);
          const py = toY(y);
          if (!started) {
            ctx.moveTo(px, py);
            started = true;
          } else {
            ctx.lineTo(px, py);
          }
        }
        ctx.stroke();

        ctx.fillStyle = 'rgba(214, 77, 110, 0.12)';
        ctx.beginPath();
        started = false;
        for (let i = 0; i <= sampleCount; i++) {
          const x = xMin + (i / sampleCount) * xRange;
          const y = f(x, a);
          if (!isFinite(y)) {
            started = false;
            continue;
          }
          const px = toX(x);
          const py = toY(y);
          if (!started) {
            ctx.moveTo(px, py);
            started = true;
          } else {
            ctx.lineTo(px, py);
          }
        }
        ctx.lineTo(toX(xMax), toY(yLo));
        ctx.lineTo(toX(xMin), toY(yLo));
        ctx.closePath();
        ctx.fill();
      }

      function heartAnimationLoop() {
        if (heartAutoAnim) updateHeartAutoAnimation();
        requestAnimationFrame(heartAnimationLoop);
      }
      heartAnimationLoop();

      slider.addEventListener('input', function () {
        checkSecret();
        draw();
      });
      window.addEventListener('resize', draw);
      draw();
    })();
  </script>
</body>
</html>
